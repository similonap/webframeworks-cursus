"use strict";(self.webpackChunkwebframeworks_cursus=self.webpackChunkwebframeworks_cursus||[]).push([[110],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>m});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),d=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=d(e.components);return a.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=d(t),m=r,f=u["".concat(s,".").concat(m)]||u[m]||p[m]||o;return t?a.createElement(f,i(i({ref:n},c),{},{components:t})):a.createElement(f,i({ref:n},c))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<o;d++)i[d]=t[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},4268:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var a=t(7462),r=(t(7294),t(3905));const o={},i="useEffect",l={unversionedId:"hooks/useEffect",id:"hooks/useEffect",title:"useEffect",description:"Side effects",source:"@site/docs/hooks/useEffect.md",sourceDirName:"hooks",slug:"/hooks/useEffect",permalink:"/webframeworks-cursus/hooks/useEffect",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Hooks",permalink:"/webframeworks-cursus/hooks/"},next:{title:"Client-side routering",permalink:"/webframeworks-cursus/routing/"}},s={},d=[{value:"Side effects",id:"side-effects",level:2},{value:"Dependencies array",id:"dependencies-array",level:2},{value:"Geen dependencies",id:"geen-dependencies",level:3},{value:"Een lege array",id:"een-lege-array",level:3},{value:"Een array van states en props",id:"een-array-van-states-en-props",level:3},{value:"Side-effect cleanup",id:"side-effect-cleanup",level:2},{value:"Praktische voorbeelden",id:"praktische-voorbeelden",level:2},{value:"Oproepen van een API",id:"oproepen-van-een-api",level:3},{value:"Opslaan in LocalStorage",id:"opslaan-in-localstorage",level:3}],c={toc:d};function p(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"useeffect"},"useEffect"),(0,r.kt)("h2",{id:"side-effects"},"Side effects"),(0,r.kt)("p",null,"Een React component gebruikt props en/of state en bepaalt hiermee een output van het component (renderen van het component). Als het react component lijnen code bevat die niet rechtstreeks bijdragen aan deze output, dan noemen we deze side-effects."),(0,r.kt)("p",null,"Voorbeelden van side-effects zijn fetch requests (API), DOM manipulaties, gebruiken van timer functies (setTimeout, setInterval), ..."),(0,r.kt)("p",null,"We willen deze side-effect logica zo hard mogelijk scheiden van de de rest van het component. We willen nooit side-effect logica rechtsreeks in het component schrijven. We hebben geen controle over hoeveel keer een component zal worden gerendered. Dit betekent dus als we side-effect logica gewoon in het component zouden schrijven dat deze ook telkens zou worden uitgevoerd als het component gerendered wordt."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'codesandbox={"template": "react-non-strict", "filename": "src/App.tsx"}',codesandbox:'{"template":','"react-non-strict",':!0,'"filename":':!0,'"src/App.tsx"}':!0},'interface GreetProps {\n    name: string\n}\n\nconst Greet = ({ name } : GreetProps) => {\n  const message = `Hello, ${name}!`;       // Output gerelateerd\n  // Niet doen:\n  document.title = `Greetings to ${name}`; // Side-effect!\n  return <div>{message}</div>;             // Output gerelateerd\n}\n//hide-start\nconst App = () => {\n    return <Greet name="Andie"/>\n}\n\nexport default App;\n//hide-end\n')),(0,r.kt)("p",null,"Hoe kunnen we nu er voor zorgen dat de side-effect losgekoppeld wordt van de rest van onze rendering code? Hiervoor hebben we de ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect()")," hook. Aan deze hook kan je code meegeven die los van de rendering code wordt uitgevoerd."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'codesandbox={"template": "react-non-strict", "filename": "src/App.tsx"}',codesandbox:'{"template":','"react-non-strict",':!0,'"filename":':!0,'"src/App.tsx"}':!0},'interface GreetProps {\n    name: string\n}\n\nconst Greet = ({ name } : GreetProps) => {\n  const message = `Hello, ${name}!`;       // Output gerelateerd\n  useEffect(() => {\n    document.title = `Greetings to ${name}`; // Side-effect!\n  }, [name]);\n  return <div>{message}</div>;             // Output gerelateerd\n}\n//hide-start\nconst App = () => {\n    return <Greet name="Andie"/>\n}\n\nexport default App;\n//hide-end\n')),(0,r.kt)("p",null,"Het updaten van de titel van het document is duidelijk een side-effect omdat het niet rechtstreeks te bijdraagt tot de output van het component. Daarom plaatsen we ",(0,r.kt)("inlineCode",{parentName:"p"},"document.title")," in de callback en geven we die mee met de ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect()")," functie."),(0,r.kt)("p",null,"We willen ook niet dat de titel van het document geupdated wordt elke keer dat het ",(0,r.kt)("inlineCode",{parentName:"p"},"Greet")," component gerendered wordt. Deze code mag enkel alleen maar uitgevoerd worden als de ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," property veranderd. Dat is de reden waarom we deze meegeven in de dependency array."),(0,r.kt)("h2",{id:"dependencies-array"},"Dependencies array"),(0,r.kt)("p",null,"We hebben tot nu toe al kort gezien dat er een tweede argument kan worden meegegeven aan de ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect()")," hook. Deze bepaald wanneer de meegegeven callback zal worden uitgevoerd. "),(0,r.kt)("p",null,"Er zijn een aantal manieren om deze dependency array te gebruiken:"),(0,r.kt)("h3",{id:"geen-dependencies"},"Geen dependencies"),(0,r.kt)("p",null,"De side-effect callback zal worden uitgevoerd na elke render van het component."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'codesandbox={"template": "react-non-strict", "filename": "src/App.tsx"}',codesandbox:'{"template":','"react-non-strict",':!0,'"filename":':!0,'"src/App.tsx"}':!0},'import { useEffect } from "react";\nconst App = () => {\n  useEffect(() => {\n    console.log("useEffect called");\n  });\n}\n//hide-start\nexport default App;\n//hide-end\n')),(0,r.kt)("p",null,"Deze wordt in principe niet veel gebruikt. "),(0,r.kt)("h3",{id:"een-lege-array"},"Een lege array"),(0,r.kt)("p",null,"De side-effect wordt 1 keer uitgevoerd na de eerste render. Daarna niet meer"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'codesandbox={"template": "react-non-strict", "filename": "src/App.tsx"}',codesandbox:'{"template":','"react-non-strict",':!0,'"filename":':!0,'"src/App.tsx"}':!0},'import { useEffect } from "react";\nconst App = () => {\n  useEffect(() => {\n    console.log("useEffect called only once!");\n  },[]);\n}\n//hide-start\nexport default App;\n//hide-end\n')),(0,r.kt)("p",null,"Een voorbeeldgebruik hiervoor is bijvoorbeeld het inladen van gegevens van een API. Gewoonlijk wil je dit maar 1 keer doen."),(0,r.kt)("h3",{id:"een-array-van-states-en-props"},"Een array van states en props"),(0,r.kt)("p",null,"De side-effect wordt enkel uitgevoerd als een van de meegegeven dependencies veranderen."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'codesandbox={"template": "react-non-strict", "filename": "src/App.tsx"}',codesandbox:'{"template":','"react-non-strict",':!0,'"filename":':!0,'"src/App.tsx"}':!0},'import { useEffect } from "react";\nconst App = () => {\n  useEffect(() => {\n    console.log("useEffect called only once!");\n  },[]);\n}\n//hide-start\nexport default App;\n//hide-end\n')),(0,r.kt)("h2",{id:"side-effect-cleanup"},"Side-effect cleanup"),(0,r.kt)("p",null,"Sommige side-effects hebben cleanup nodig: afsluiten van verbindingen, timers clearen."),(0,r.kt)("p",null,"Je kan de cleanup code plaatsen in een functie die je als return waarde teruggeeft:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"useEffect(() => {\n  // Side-effect...\n  return () => {\n    // Side-effect cleanup...\n  };\n}, []);\n")),(0,r.kt)("p",null,"Een concreet voorbeeld hiervan is het zetten van een timer. Als we geen cleanup code voorzien worden timers nooit gestopt en blijven die gewoon lopen zelfs al veranderd hier de interval."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'codesandbox={"template": "react-non-strict", "filename": "src/App.tsx"}',codesandbox:'{"template":','"react-non-strict",':!0,'"filename":':!0,'"src/App.tsx"}':!0},'import { useEffect,useState } from "react";\n\ninterface TimerProps {\n  interval: number\n}\n\nconst Timer = ({interval} : TimerProps) => {\n  const [number, setNumber] = useState(0);\n  useEffect(() => {\n    let handle = setInterval(() => {\n       setNumber(number => number + 1);\n    },interval);\n\n    return () => {\n      clearInterval(handle);\n    }\n  },[interval]);\n\n  return <p>{number}</p>\n}\n\n\nconst App = () => {\n    const [interval, setInterval] = useState(1000);\n    return (\n      <>\n        <div>\n            <input type="range" min="1" max="2000" value={interval} onChange={(e) => setInterval(parseInt(e.target.value))}/>\n            <label htmlFor="volume">{interval}</label>\n        </div>\n        <Timer interval={interval} />\n      </>\n    );\n}\n\nexport default App;\n')),(0,r.kt)("h2",{id:"praktische-voorbeelden"},"Praktische voorbeelden"),(0,r.kt)("h3",{id:"oproepen-van-een-api"},"Oproepen van een API"),(0,r.kt)("p",null,"Een perfect voorbeeld waar ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect()")," wordt gebruikt is het ophalen van data uit een API. We gaan in dit voorbeeld gebruik maken van de World Time API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"http://worldtimeapi.org/api/timezone/Europe/Brussels\n")),(0,r.kt)("p",null,"De data voldoet aan de volgende interface:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"interface TimezoneInfo {\n    abbreviation: string;\n    client_ip: string;\n    datetime: Date;\n    day_of_week: number;\n    day_of_year: number;\n    dst: boolean;\n    dst_from: Date;\n    dst_offset: number;\n    dst_until: Date;\n    raw_offset: number;\n    timezone: string;\n    unixtime: number;\n    utc_datetime: Date;\n    utc_offset: string;\n    week_number: number;\n}\n")),(0,r.kt)("p",null,"Het ophalen van data heeft nooit direct invloed op het renderen van het component. Dit komt omdat dit asynchroon gebeurd, dus op de moment dat de API aangeroepen wordt is er nog geen data beschikbaar en het renderen van componenten in react kan nooit asynchroon gebeuren. Daarom moet deze code in een side effect gebeuren."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'codesandbox={"template": "react", "filename": "src/App.tsx"}',codesandbox:'{"template":','"react",':!0,'"filename":':!0,'"src/App.tsx"}':!0},'//hide-start\nimport { useState, useEffect } from "react";\n\ninterface TimezoneInfo {\n    abbreviation: string;\n    client_ip: string;\n    datetime: Date;\n    day_of_week: number;\n    day_of_year: number;\n    dst: boolean;\n    dst_from: Date;\n    dst_offset: number;\n    dst_until: Date;\n    raw_offset: number;\n    timezone: string;\n    unixtime: number;\n    utc_datetime: Date;\n    utc_offset: string;\n    week_number: number;\n}\n//hide-end\nconst App = () => {\n    const [timezoneInfo, setTimezoneInfo] = useState<TimezoneInfo>();\n\n    useEffect(() => {\n        const fetchFunction = async() => {\n            let result = await fetch("https://worldtimeapi.org/api/timezone/Europe/Brussels");\n            let json : TimezoneInfo = await result.json(); \n\n            setTimezoneInfo(json);\n        }\n        fetchFunction();\n    },[]);\n\n    return (\n        <>\n            {timezoneInfo && (\n                <ul>\n                    <li>IP: {timezoneInfo.client_ip}</li>\n                    <li>TimeZone: {timezoneInfo.timezone}</li>\n                    <li>Time: {timezoneInfo.datetime}</li>\n                </ul>\n            )}\n\n        </>\n    );\n}\n//hide-start\nexport default App;\n//hide-end\n')),(0,r.kt)("p",null,"We gebruiken hier een ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect")," met een lege dependency array omdat we deze API call maar 1 keer willen uitvoeren bij het mounten van dit component."),(0,r.kt)("p",null,"De callback die we meegeven aan ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect")," mag niet ",(0,r.kt)("inlineCode",{parentName:"p"},"async")," zijn dus we maken een aparte asynchrone functie die we dan in de ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect")," callback oproepen."),(0,r.kt)("h3",{id:"opslaan-in-localstorage"},"Opslaan in LocalStorage"),(0,r.kt)("p",null,"Local storage laat toe bepaalde configuraties of user settings bij te houden in de browser van de gebruiker. Local storage kan bijvoorbeeld gebruikt worden om de inhoud van een veld op te slaan, zodat dit terug kan worden ingevuld wanneer de gebruiker de pagina opnieuw opent."),(0,r.kt)("p",null,"We kunnen deze waarde alvast uitlezen bij het zetten van de default waarde van onze state. Veronderstel bijvoorbeeld een veld name voor de naam van de gebruiker:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'const [name, setName] = useState<string>(localStorage.getItem("name") ?? "");\n')),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"De operator ?? staat toe een defaultwaarde te voorzien. Als de waarde langs de linkerkant null of undefined is, wordt de waarde langs de rechterkant gebruikt.")),(0,r.kt)("p",null,"Door middel van een side-effect kunnen we elke wijziging aan de state variabele ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," opslaan. Om dit te verwezenlijken moeten we ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," in de dependency array meenemen zodat onze callback functie telkens wordt opgeroepen als deze veranderd."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'codesandbox={"template": "react-non-strict", "filename": "src/App.tsx"}',codesandbox:'{"template":','"react-non-strict",':!0,'"filename":':!0,'"src/App.tsx"}':!0},'//hide-start\nimport {useEffect, useState} from "react";\n//hide-end\nconst App = () => {\n  const [name, setName] = useState<string>(localStorage.getItem("name") ?? "");\n\n  useEffect(() => {\n    localStorage.setItem("name", name);\n  },[name]);\n\n  return (\n    <>\n      <input type="text" value={name} onChange={(e) => setName(e.target.value)}/>\n    </>\n  )\n}\n//hide-start\nexport default App;\n//hide-end\n')))}p.isMDXComponent=!0}}]);