"use strict";(self.webpackChunkwebframeworks_cursus=self.webpackChunkwebframeworks_cursus||[]).push([[9274],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>u});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=a.createContext({}),p=function(e){var n=a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},s=function(e){var n=p(e.components);return a.createElement(d.Provider,{value:n},e.children)},k={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,d=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),m=p(t),u=r,g=m["".concat(d,".").concat(u)]||m[u]||k[u]||i;return t?a.createElement(g,l(l({ref:n},s),{},{components:t})):a.createElement(g,l({ref:n},s))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,l=new Array(i);l[0]=m;var o={};for(var d in n)hasOwnProperty.call(n,d)&&(o[d]=n[d]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=t[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},7622:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>k,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=t(7462),r=(t(7294),t(3905));const i={sidebar_position:1},l="Strapi",o={unversionedId:"wf-course/advanced/headless-cms/strapi",id:"wf-course/advanced/headless-cms/strapi",title:"Strapi",description:"In deze cursus gaan we gebruik maken van Strapi. Dit is een headless CMS dat specifiek gemaakt is om te gebruiken als headless CMS. Het is open source en gratis te gebruiken. Het is ook heel eenvoudig om te gebruiken. Het is volledig geschreven in JavaScript en maakt gebruik van Node.js. Je kan het dus gemakkelijk installeren met behulp van npm.",source:"@site/docs/wf-course/advanced/headless-cms/strapi.md",sourceDirName:"wf-course/advanced/headless-cms",slug:"/wf-course/advanced/headless-cms/strapi",permalink:"/webframeworks-cursus/wf-course/advanced/headless-cms/strapi",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"wfCourse",previous:{title:"Headless CMS",permalink:"/webframeworks-cursus/wf-course/advanced/headless-cms/"},next:{title:"Recepten voor React.js",permalink:"/webframeworks-cursus/wf-course/recepten/"}},d={},p=[{value:"Strapi installeren",id:"strapi-installeren",level:2},{value:"Content types",id:"content-types",level:2},{value:"Voorbeeld blog posts",id:"voorbeeld-blog-posts",level:3},{value:"REST API",id:"rest-api",level:2},{value:"API Token",id:"api-token",level:2},{value:"Image upload",id:"image-upload",level:2},{value:"Cloudinary plugin installeren",id:"cloudinary-plugin-installeren",level:3},{value:"Blog post aanpassen",id:"blog-post-aanpassen",level:3},{value:"Deployen naar Render",id:"deployen-naar-render",level:2},{value:"Database aanpassen",id:"database-aanpassen",level:2},{value:"Environment variabelen",id:"environment-variabelen",level:2},{value:"Markdown",id:"markdown",level:2}],s={toc:p};function k(e){let{components:n,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,i,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"strapi"},"Strapi"),(0,r.kt)("p",null,"In deze cursus gaan we gebruik maken van ",(0,r.kt)("a",{parentName:"p",href:"https://strapi.io/"},"Strapi"),". Dit is een headless CMS dat specifiek gemaakt is om te gebruiken als headless CMS. Het is open source en gratis te gebruiken. Het is ook heel eenvoudig om te gebruiken. Het is volledig geschreven in JavaScript en maakt gebruik van Node.js. Je kan het dus gemakkelijk installeren met behulp van npm. "),(0,r.kt)("p",null,"Strapi applicaties kunnen op een server worden ge\xefnstalleerd of lokaal worden uitgevoerd. We gaan eerst zien hoe je een strapi applicatie kan installeren op je lokale machine. Vervolgens gaan we deze applicatie deployen naar een server."),(0,r.kt)("h2",{id:"strapi-installeren"},"Strapi installeren"),(0,r.kt)("p",null,"Om Strapi te installeren moeten we het volgende commando uitvoeren:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx create-strapi-app@latest my-project\n")),(0,r.kt)("p",null,"We moeten vervolgens een installatie type kiezen. Op dit moment zullen we ",(0,r.kt)("inlineCode",{parentName:"p"},"Quickstart (recommended)")," kiezen. Dit is de eenvoudigste manier om strapi te installeren en gebruikt een SQLite database. Dit is een database die in een bestand wordt opgeslagen. Dit is ideaal voor lokale ontwikkeling, maar niet ideaal voor productie. "),(0,r.kt)("p",null,"Vervolgens zal de installatie beginnen. Dit kan even duren. Als de installatie klaar is, zal de applicatie automatisch opstarten. Je kan de applicatie ook zelf opstarten met het volgende commando:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm run develop\n")),(0,r.kt)("p",null,"Als je naar de applicatie surft, dan zal je een scherm zien waar je een account kan aanmaken. Dit account heb je nodig om in te loggen in de applicatie. "),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Alt text",src:t(5853).Z,width:"1026",height:"1338"})),(0,r.kt)("h2",{id:"content-types"},"Content types"),(0,r.kt)("p",null,"Als je bent ingelogd in de applicatie, dan kan je content types aanmaken. Een content type is een soort van model dat je kan gebruiken om data op te slaan in de database. Je kan bijvoorbeeld een content type aanmaken voor blogposts. Dit content type bevat dan een aantal velden zoals bijvoorbeeld een titel, een inhoud, een auteur, een datum, enzovoort. "),(0,r.kt)("p",null,"Er is altijd een content type aanwezig met de naam ",(0,r.kt)("inlineCode",{parentName:"p"},"User"),". Dit content type bevat een aantal velden zoals bijvoorbeeld een gebruikersnaam, een email, een wachtwoord, enzovoort. Dit content type wordt gebruikt om gebruikers aan te maken die kunnen inloggen in de applicatie."),(0,r.kt)("p",null,"Er zijn 3 verschillende soorten content types:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Collection types (bijvoorbeeld blogposts). Dit zijn content types die meerdere items bevatten. Je kan bijvoorbeeld meerdere blogposts aanmaken."),(0,r.kt)("li",{parentName:"ul"},"Single types (bijvoorbeeld een homepage). Dit zijn content types die maar 1 item bevatten. "),(0,r.kt)("li",{parentName:"ul"},"Component types (bijvoorbeeld een header). Dit zijn content types die je kan gebruiken in andere content types. Als je een bepaald stuk van een content type wil hergebruiken, dan kan je dit stuk in een component type plaatsen en dit component type gebruiken in andere content types.")),(0,r.kt)("h3",{id:"voorbeeld-blog-posts"},"Voorbeeld blog posts"),(0,r.kt)("p",null,"We gaan als voorbeeld een collection content type aanmaken voor blogposts. We gaan dit content type ",(0,r.kt)("inlineCode",{parentName:"p"},"Post")," noemen. "),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Alt text",src:t(3304).Z,width:"1312",height:"724"})),(0,r.kt)("p",null,"Je krijgt in het eerste venster ineens te zien welke API endpoints er worden aangemaakt voor dit content type. Je kan deze endpoints gebruiken om data op te halen van de server. We gaan dit later in de cursus gebruiken om data op te halen van de server."),(0,r.kt)("p",null,"Vervolgens moeten we de velden van het content type aanmaken. We gaan de volgende velden aanmaken:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"title: Text"),(0,r.kt)("li",{parentName:"ul"},"content: Rich Text"),(0,r.kt)("li",{parentName:"ul"},"author: Relation (met het User content type)"),(0,r.kt)("li",{parentName:"ul"},"published_at: DateTime")),(0,r.kt)("p",null,"De keuze van Rich Text is belangrijk. Dit betekent dat we een rich text editor kunnen gebruiken om de inhoud van de blogpost te schrijven. Dit is een editor die je kan gebruiken om tekst op te maken. Je kan bijvoorbeeld tekst vet maken, tekst cursief maken, lijsten maken, afbeeldingen toevoegen, enzovoort."),(0,r.kt)("p",null,"Voor de author veld moeten we een relatie leggen met het User content type. Dit wil zeggen dat we een gebruiker kunnen kiezen als auteur van de blogpost. We kiezen hiervoor de ",(0,r.kt)("inlineCode",{parentName:"p"},"Many to one")," relatie. Dit wil zeggen dat een gebruiker meerdere blogposts kan schrijven, maar dat een blogpost maar 1 auteur kan hebben."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Alt text",src:t(5857).Z,width:"1314",height:"638"})),(0,r.kt)("p",null,"Omdat we ook moeten weten wanneer de blogpost is gepubliceerd, moeten we een ",(0,r.kt)("inlineCode",{parentName:"p"},"published_at")," veld toevoegen. Dit veld is van het type ",(0,r.kt)("inlineCode",{parentName:"p"},"DateTime"),". Dit wil zeggen dat we een datum en een tijd kunnen kiezen."),(0,r.kt)("p",null,"Vervolgens moet je op de ",(0,r.kt)("inlineCode",{parentName:"p"},"Save")," knop klikken om het content type op te slaan. Na het opslaan wordt de server automatisch herstart. Het kan zijn dat je de pagina moet herladen om de wijzigingen te zien."),(0,r.kt)("p",null,"Nu kunnen we effectief een blog post aanmaken. Je kan dan naar de Content Manager gaan en vervolgens op de ",(0,r.kt)("inlineCode",{parentName:"p"},"Post")," link klikken. Je krijgt dan een overzicht te zien van alle blogposts. Uiteraard is er nog geen blogpost aanwezig. Je kan een blogpost aanmaken door op de ",(0,r.kt)("inlineCode",{parentName:"p"},"Create an entry")," knop te klikken. Je krijgt dan een formulier te zien waar je de blogpost kan aanmaken. De rich text editor heeft support voor Markdown. Als je meer wil weten over Markdown, dan kan je ",(0,r.kt)("a",{parentName:"p",href:"https://www.markdownguide.org/basic-syntax/"},"hier")," meer informatie vinden."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Alt text",src:t(6233).Z,width:"1908",height:"1338"})),(0,r.kt)("h2",{id:"rest-api"},"REST API"),(0,r.kt)("p",null,"Voor elke collection content type wordt er automatisch een REST API endpoint aangemaakt. Dit endpoint kan je gebruiken om data op te halen van de server of om data te versturen naar de server. "),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Method"),(0,r.kt)("th",{parentName:"tr",align:null},"URL"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"GET")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/:pluralApiId")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#get-entries"},"Get a list of entries"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"POST")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/:pluralApiId")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#create-an-entry"},"Create an entry"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"GET")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/:pluralApiId/:documentId")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#get-an-entry"},"Get an entry"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"PUT")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/:pluralApiId/:documentId")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#update-an-entry"},"Update an entry"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"DELETE")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/:pluralApiId/:documentId")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#delete-an-entry"},"Delete an entry"))))),(0,r.kt)("p",null,"Dus in ons geval bij de blog posts:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Method"),(0,r.kt)("th",{parentName:"tr",align:null},"URL"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"GET")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/posts")),(0,r.kt)("td",{parentName:"tr",align:null},"Get a list of all blog posts")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"POST")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/posts")),(0,r.kt)("td",{parentName:"tr",align:null},"Create a new blog post")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"GET")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/posts/:id")),(0,r.kt)("td",{parentName:"tr",align:null},"Get a specific blog post")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"PUT")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/posts/:id")),(0,r.kt)("td",{parentName:"tr",align:null},"Update a specific blog post")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"DELETE")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/posts/:id")),(0,r.kt)("td",{parentName:"tr",align:null},"Delete a specific blog post")))),(0,r.kt)("p",null,"Strapi biedt een heel gamma van query parameters aan die het mogelijk maken om te filteren, sorteren en pagineren. Deze kan je vinden op de ",(0,r.kt)("a",{parentName:"p",href:"https://docs.strapi.io/dev-docs/api/rest/parameters"},"Strapi documentatie"),"."),(0,r.kt)("p",null,"Je kan ook de ",(0,r.kt)("a",{parentName:"p",href:"https://docs.strapi.io/dev-docs/api/rest/interactive-query-builder"},"Interactive query builder")," gebruiken om de query parameters te genereren. "),(0,r.kt)("h2",{id:"api-token"},"API Token"),(0,r.kt)("p",null,"Vooraleer je gebruik kan maken van deze endpoints moet je een API Token aanmaken en aangeven wat de gebruiker van deze token allemaal mag uitvoeren. Je kan dit doen door naar de ",(0,r.kt)("inlineCode",{parentName:"p"},"Settings")," tab te gaan en vervolgens op API tokens te klikken. Daarna klik je op ",(0,r.kt)("inlineCode",{parentName:"p"},"Create new API token"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Alt text",src:t(1577).Z,width:"2752",height:"934"})),(0,r.kt)("p",null,"Vervolgens krijg je het settings scherm te zien van de nieuwe token. Je kan hier de volgende zaken instellen:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Name: De naam van de token."),(0,r.kt)("li",{parentName:"ul"},"Description: Een beschrijving van de token."),(0,r.kt)("li",{parentName:"ul"},"Token duration: De duur van de token. Wanneer de token vervalt, dan kan je deze niet meer gebruiken. Je kan een token ook manueel deactiveren. Voor deze cursus kiezen we altijd Unlimited."),(0,r.kt)("li",{parentName:"ul"},"Token type: Je kan hier kiezen tussen Read-Only, Full Access en Custom. Meestal kiezen we hier een Read-Only token als we willen voorkomen dat de applicatie data kan aanpassen. Je kan ook per content type aangeven wat de token mag doen. Dit is handig als we bijvoorbeeld een commenting systeem willen bouwen waar de gebruikers comments kunnen aanmaken, maar niet kunnen aanpassen of verwijderen. We willen uiteraard niet dat een gewone gebruiker van de blog blogposts kan aanpassen of verwijderen.")),(0,r.kt)("p",null,"Na het aanmaken van een token krijg je de token te zien. Je kan deze nu meegeven als Bearer token in de header van je request. Nu zal je zien dat je wel data kan ophalen van de server maar niet kan aanpassen of verwijderen."),(0,r.kt)("p",null,"Nu zou je bijvoorbeeld met fetch data kunnen ophalen van de server. Je kan bijvoorbeeld de volgende code gebruiken om alle blogposts op te halen:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'const response = await fetch("http://localhost:1337/api/posts?populate=*", {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n});\n\nconst posts = await response.json();\n')),(0,r.kt)("p",null,"We voegen hier de ",(0,r.kt)("inlineCode",{parentName:"p"},"populate=*")," parameter toe om de author van de blogpost op te halen. Als je dit niet doet, dan krijg je enkel de id van de author te zien. "),(0,r.kt)("h2",{id:"image-upload"},"Image upload"),(0,r.kt)("p",null,"Het is mogelijk ook afbeeldingen te uploaden met strapi. By default worden deze afbeeldingen opgeslagen in een lokale folder. Omdat het niet altijd mogelijk is om afbeeldingen lokaal op te slaan, kan je ook gebruik maken van een externe service zoals Amazon S3 of Cloudinary. "),(0,r.kt)("p",null,"In deze cursus gaan we gebruik maken van Cloudinary. Dit is een service die het mogelijk maakt om afbeeldingen op te slaan in de cloud. Je kan een gratis account aanmaken op ",(0,r.kt)("a",{parentName:"p",href:"https://cloudinary.com/"},"Cloudinary"),"."),(0,r.kt)("p",null,"In het dashboard kan je de volgende informatie vinden:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Cloud name"),(0,r.kt)("li",{parentName:"ul"},"API Key"),(0,r.kt)("li",{parentName:"ul"},"API Secret")),(0,r.kt)("p",null,"Deze informatie heb je later nodig om de afbeeldingen te uploaden naar Cloudinary via Strapi."),(0,r.kt)("h3",{id:"cloudinary-plugin-installeren"},"Cloudinary plugin installeren"),(0,r.kt)("p",null,"Het eerste wat je moet doen is de Cloudinary plugin installeren. Dit doe je door het volgende commando uit te voeren:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @strapi/provider-upload-cloudinary\n")),(0,r.kt)("p",null,"Zorg ervoor dat de strapi server niet draait als je dit commando uitvoert."),(0,r.kt)("p",null,"Daarna moet je een ",(0,r.kt)("inlineCode",{parentName:"p"},"./config/plugins.js")," bestand aanmaken met de volgende inhoud:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = ({ env }) => ({\n  upload: {\n    config: {\n      provider: 'cloudinary',\n      providerOptions: {\n        cloud_name: env('CLOUDINARY_NAME'),\n        api_key: env('CLOUDINARY_KEY'),\n        api_secret: env('CLOUDINARY_SECRET'),\n      },\n      actionOptions: {\n        upload: {},\n        delete: {},\n      },\n    },\n  }\n});\n")),(0,r.kt)("p",null,"Deze plugin maakt gebruik van environment variabelen. Deze variabelen kan je instellen in het ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," bestand. Je kan dit bestand aanmaken in de root van je project. Je kan de volgende variabelen toevoegen:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"CLOUDINARY_NAME = cloudinary-name\nCLOUDINARY_KEY = cloudinary-key\nCLOUDINARY_SECRET = cloudinary-secret\n")),(0,r.kt)("p",null,"Er moet nog een laatste stap worden uitgevoerd om de security policy van strapi aan te passen. Je moet een wijziging maken in ",(0,r.kt)("inlineCode",{parentName:"p"},"./config/middlewares.js"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = [\n  'strapi::errors',\n  {\n    name: 'strapi::security',\n    config: {\n      contentSecurityPolicy: {\n        useDefaults: true,\n        directives: {\n          'connect-src': [\"'self'\", 'https:'],\n          'img-src': [\"'self'\", 'data:', 'blob:', 'res.cloudinary.com'],\n          'media-src': [\"'self'\", 'data:', 'blob:', 'res.cloudinary.com'],\n          upgradeInsecureRequests: null,\n        },\n      },\n    },\n  },\n  'strapi::cors',\n  'strapi::poweredBy',\n  'strapi::logger',\n  'strapi::query',\n  'strapi::body',\n  'strapi::session',\n  'strapi::favicon',\n  'strapi::public',\n];\n")),(0,r.kt)("p",null,"Zonder deze wijziging zal je een error krijgen als je een afbeelding wil uploaden."),(0,r.kt)("h3",{id:"blog-post-aanpassen"},"Blog post aanpassen"),(0,r.kt)("p",null,"Nu kunnen we de blog post aanpassen zodat we een afbeelding kunnen toevoegen. We gaan een nieuw veld toevoegen aan het blog post content type. Dit veld noemen we ",(0,r.kt)("inlineCode",{parentName:"p"},"image")," en is van het type ",(0,r.kt)("inlineCode",{parentName:"p"},"Media"),". Dit is een speciaal type dat we kunnen gebruiken om afbeeldingen op te slaan."),(0,r.kt)("p",null,"Nu kunnen we een blog post aanmaken met een afbeelding. Als je de blog post opslaat, dan zal de afbeelding automatisch worden ge\xfcpload naar Cloudinary. Je kan dit controleren door naar de Cloudinary website te gaan. Je zal zien dat de afbeelding is ge\xfcpload naar Cloudinary."),(0,r.kt)("h1",{id:"naar-productie-brengen"},"Naar productie brengen"),(0,r.kt)("h2",{id:"deployen-naar-render"},"Deployen naar Render"),(0,r.kt)("p",null,"We gaan onze applicatie deployen naar ",(0,r.kt)("a",{parentName:"p",href:"https://render.com/"},"Render"),". Dit is een platform dat het mogelijk maakt om applicaties te deployen. Het is heel eenvoudig om te gebruiken en je kan het gratis gebruiken voor kleine applicaties."),(0,r.kt)("p",null,"Je moet er eerst voor zorgen dat je applicatie ergens op een github repository staat zodat render deze kan gebruiken voor de deploy. "),(0,r.kt)("p",null,"Je moet de volgende stappen uitvoeren:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Je moet een nieuwe web service aanmaken. Je kan dit doen door op de ",(0,r.kt)("inlineCode",{parentName:"li"},"New")," en vervolgens op ",(0,r.kt)("inlineCode",{parentName:"li"},"Web Service")," te klikken."),(0,r.kt)("li",{parentName:"ul"},"Klik eerst op ",(0,r.kt)("inlineCode",{parentName:"li"},"Build and deploy from a Git repository")," om je github repository te koppelen aan render. Kies de juiste repository."),(0,r.kt)("li",{parentName:"ul"},"Kies een naam voor je service. Dit is de naam die je zal zien in de url. "),(0,r.kt)("li",{parentName:"ul"},"Verander de region naar een EU gebaseerde regio. "),(0,r.kt)("li",{parentName:"ul"},"Kies de juiste branch."),(0,r.kt)("li",{parentName:"ul"},"Indien je project ergens in een subfolder staat, dan kan je dit aangeven bij ",(0,r.kt)("inlineCode",{parentName:"li"},"Root Directory"),"."),(0,r.kt)("li",{parentName:"ul"},"Zorg ervoor dat je als runtime ",(0,r.kt)("inlineCode",{parentName:"li"},"Node")," kiest. "),(0,r.kt)("li",{parentName:"ul"},"Bij build command moet je ",(0,r.kt)("inlineCode",{parentName:"li"},"npm install && npm run build")," invullen. Dit is het commando dat render zal uitvoeren om je applicatie te builden."),(0,r.kt)("li",{parentName:"ul"},"Als ",(0,r.kt)("inlineCode",{parentName:"li"},"Start Command")," moet je ",(0,r.kt)("inlineCode",{parentName:"li"},"npm start")," invullen. Dit is het commando dat render zal uitvoeren om je applicatie te starten."),(0,r.kt)("li",{parentName:"ul"},"Kies zeker voor ",(0,r.kt)("inlineCode",{parentName:"li"},"Instance Type")," ",(0,r.kt)("inlineCode",{parentName:"li"},"Free"),". Dit is de gratis versie van render. Je kan ook kiezen voor een betalende versie, maar dit is niet nodig voor deze cursus.")),(0,r.kt)("p",null,"Vervolgens open je het ",(0,r.kt)("inlineCode",{parentName:"p"},"Advanced")," tab. Hier is het mogelijk om environment variabelen in te stellen. Je kan hier gebruik maken van een ",(0,r.kt)("inlineCode",{parentName:"p"},"secret file"),". Maak een nieuw ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," bestand aan (in de editor van render) en kopieer de inhoud van je lokale ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," bestand naar dit bestand. "),(0,r.kt)("h2",{id:"database-aanpassen"},"Database aanpassen"),(0,r.kt)("p",null,"We gaan nu de database aanpassen. We gaan de database veranderen van SQLite naar PostgreSQL. Dit is een database die we kunnen gebruiken in productie. Als we sqlite zouden gebruiken in productie, dan zou de database verloren gaan als de server herstart."),(0,r.kt)("p",null,"Zorg ervoor dat je eerst een database hebt aangemaakt in PostgreSQL. "),(0,r.kt)("p",null,"Normaal gezien moet je enkel de volgende environment variabelen aanpassen in het ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," bestand of de secret file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Database\nDATABASE_CLIENT=postgres\nDATABASE_HOST=ip-adres\nDATABASE_NAME=naam-database\nDATABASE_USERNAME=username\nDATABASE_PASSWORD=password\n")),(0,r.kt)("p",null,"Let op dat je deze .env file niet in je git repository plaatst. Deze bevat namelijk gevoelige informatie zoals het wachtwoord van de database. Plaats deze file dus in je ",(0,r.kt)("inlineCode",{parentName:"p"},".gitignore")," file."),(0,r.kt)("p",null,"Voordat je kan gebruik maken van postgres in je strapi applicatie moet je nog wel een package installeren. Dit doe je door het volgende commando uit te voeren:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install pg\n")),(0,r.kt)("h1",{id:"koppeling-nextjs-en-strapi"},"Koppeling next.js en strapi"),(0,r.kt)("h2",{id:"environment-variabelen"},"Environment variabelen"),(0,r.kt)("p",null,"Omdat we de API token die we zelf hebben aangemaakt ook willen gebruiken in onze next.js applicatie, moeten we deze token opslaan in een environment variabele. Net zoals we dit hebben gedaan bij strapi moeten we ook hier een ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," bestand aanmaken. Dit bestand moet je aanmaken in de root van je next.js project. Hier kan je een ",(0,r.kt)("inlineCode",{parentName:"p"},"TOKEN")," variabele aanmaken en de token van strapi hierin opslaan. "),(0,r.kt)("p",null,"We kunnen deze dan op de volgende manier uitlezen in onze next.js applicatie:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"const token = process.env.TOKEN;\n")),(0,r.kt)("p",null,"Let er op je kan deze variabele enkel maar gebruiken in de server code. Je kan deze niet gebruiken in de client code want deze variabele wordt niet meegestuurd naar de client. Dus je kan deze enkel in de ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticProps"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"getServerSideProps")," functies gebruiken."),(0,r.kt)("h2",{id:"markdown"},"Markdown"),(0,r.kt)("p",null,"Alle rich text velden worden opgeslagen in markdown. Dit is een speciale syntax die je kan gebruiken om tekst op te maken. Je kan bijvoorbeeld tekst vet maken, tekst cursief maken, lijsten maken, afbeeldingen toevoegen, enzovoort."),(0,r.kt)("p",null,"Hier een voorbeeld van een aantal features van markdown:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-markdown"},"# Heading 1\n## Heading 2\n### Heading 3\n**Bold text**\n*Italic text*\n- List item 1\n- List item 2\n- List item 3\n\n![Alt text](image.png)\n")),(0,r.kt)("p",null,"We zijn van plan om de inhoud van de blogpost te tonen op de website. We moeten dus de markdown omzetten naar HTML. We gaan dit doen met de ",(0,r.kt)("inlineCode",{parentName:"p"},"next-mdx-remote")," package. Deze package zorgt ervoor dat we markdown kunnen omzetten naar HTML."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install next-mdx-remote\n")),(0,r.kt)("p",null,"Nu kan je de serialize functie importeren in je code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import { serialize } from 'next-mdx-remote';\n")),(0,r.kt)("p",null,"Je kan deze functie gebruiken om markdown om te zetten naar HTML. Je kan de volgende code gebruiken om de markdown om te zetten naar HTML:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"const mdxSource = await serialize(post.attributes.content);\n")),(0,r.kt)("p",null,"deze kan je in de getStaticProps functie plaatsen. Je kan dan de mdxSource doorgeven aan de props van de pagina. Je kan dan de volgende code gebruiken om de HTML te tonen:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"<MDXRemote {...mdxSource} />\n")),(0,r.kt)("p",null,"Dan bekom je iets zoals dit:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'export async function getStaticProps() {\n  const response = await fetch("http://localhost:1337/api/posts?populate=*", {\n    headers: {\n      Authorization: `Bearer ${process.env.TOKEN}`,\n    },\n  });\n\n  const posts : PostResponse = await response.json();\n\n  const serializedPosts: PostShort[] = await Promise.all(\n    posts.data.map(async (post) => {\n      const mdxSource = await serialize(post.attributes.content);\n      return {\n        cover: post.attributes.cover.data.attributes.formats.large.url,\n        title: post.attributes.title,\n        name: post.attributes.author.data.attributes.firstname + " " + post.attributes.author.data.attributes.lastname,\n        content: mdxSource,\n      };\n    })\n  );\n\n  return {\n    props: {\n      posts: serializedPosts,\n    },\n  };\n}\n')),(0,r.kt)("p",null,"De ",(0,r.kt)("inlineCode",{parentName:"p"},"PostResponse")," interface kan je genereren met behulp van ",(0,r.kt)("a",{parentName:"p",href:"https://app.quicktype.io/"},"Quicktype")," aan de hand van de JSON data die je krijgt van de server. En de ",(0,r.kt)("inlineCode",{parentName:"p"},"PostShort")," interface kan je als volgt defini\xebren:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"export interface PostShort {\n    title: string;\n    content: MDXRemoteSerializeResult;\n    cover: string;\n    name: string;\n}\n")),(0,r.kt)("p",null,"Dit is een verkorte versie van de Post interface die we later gaan gebruiken. Deze interface bevat enkel de velden die we nodig hebben om de blog post te tonen op de website."),(0,r.kt)("p",null,"In je blog post component kan je dan de volgende code gebruiken om de HTML te tonen:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"<MDXRemote {...post.content} />\n")),(0,r.kt)("p",null,"Je kan het uiterlijk per markdown element aanpassen. Je kan bijvoorbeeld de volgende code gebruiken om de headings een andere stijl te geven:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'<MDXRemote {...post.content} components={{\n    h1: ({children}) => (<h1 className="text-xl">{children}</h1>),\n    h2: ({children}) => (<h2 className="text-l">{children}</h2>),\n    h3: ({children}) => (<h2 className="text-m">{children}</h2>),\n    p: ({children}) => (<p className="text-m mt-4">{children}</p>)\n}} />\n')))}k.isMDXComponent=!0},5853:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/Screenshot 2023-09-24 at 22.01.48-502fc17bbfcf9b7229927e31e120160e.png"},3304:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/Screenshot 2023-09-24 at 22.18.15-7a1049370d9c52c06faa2ab16bc1c837.png"},5857:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/Screenshot 2023-09-24 at 22.24.14-3b7e98f96076b8045691aef17f54243b.png"},6233:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/Screenshot 2023-09-24 at 22.45.04-4eb6d62b10ec1fe76243dc46313e7c78.png"},1577:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/Screenshot 2023-09-25 at 12.13.30-a9c627061db1af4d9931e09a774efe10.png"}}]);